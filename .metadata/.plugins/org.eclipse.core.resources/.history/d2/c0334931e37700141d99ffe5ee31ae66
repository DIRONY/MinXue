package com.sea.minxue.dialogue;

import com.sea.minxue.QuestionDatabaseHelper;
import com.sea.minxue.R;

import android.app.ExpandableListActivity;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.ExpandableListView;
import android.widget.ExpandableListView.OnGroupClickListener;
import android.widget.ImageView;

public class CategoryActivity extends ExpandableListActivity {
	
	private int sql_code;
	QuestionDatabaseHelper questiondbhelper;
	SQLiteDatabase questiondb;
	CategoryAdapter cateadapter=null;
	Cursor cursor;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_category);
		sql_code=getIntent().getIntExtra("position", 0);
		questiondbhelper=new QuestionDatabaseHelper(this);
		questiondb=questiondbhelper.getWritableDatabase();
		if(sql_code!=0){
			cursor=questiondb.rawQuery("select * from scene where cat = "+sql_code, null);
		}
		else{
			cursor=questiondb.rawQuery("select * from scene where flag = 1", null);
		}
		cateadapter=new CategoryAdapter(this,cursor);
		setListAdapter(cateadapter);
		getExpandableListView().setOnGroupClickListener(new OnGroupClickListener() {
			
			@Override
			public boolean onGroupClick(ExpandableListView parent, View v,
					int groupPosition, long id) {
				// TODO Auto-generated method stub
				final int position=groupPosition;
				String sql_col;
				ImageView collect=(ImageView) v.findViewById(R.id.collect);
				collect.setOnClickListener(new OnClickListener() {
					
					@Override
					public void onClick(View v) {
						// TODO Auto-generated method stub
						if(cursor.moveToPosition(position)){
							sql_col=cursor.getString(cursor.getColumnIndex("pinyin"));
						}
						questiondb.execSQL("update scene set flag = 1 where pinyin ="+sql_col);
					}
				});
				
				return true;
			}
		});
		
	}
	
}
